# Tutorial 1: Hyperledger Fabric V1.2.0 - Create a Development Business Network on Ubuntu 16.04 LTS

This article is a tutorial that guides you how to create a Hyperledger Fabric v.1.2.0 business network on Ubuntu 16.04 LTS using the development tools that are found in the Hyperledger Fabric repository.

We will go through the process of setting up the Hyperledger Fabric prerequisites and later on we define and start Hyperledger Fabric blockchain network between three organizations.


- [Tutorial 1: Hyperledger Fabric V1.2.0 - Create a Development Business Network on Ubuntu 16.04 LTS](#tutorial-1-hyperledger-fabric-v120---create-a-development-business-network-on-ubuntu-1604-lts)
    - [Recommended Reading](#recommended-reading)
    - [Setup Your Environment](#setup-your-environment)
        - [Utility Packages](#utility-packages)
        - [Docker](#docker)
        - [Docker Compose](#docker-compose)
        - [Go language](#go-language)
    - [Retrieve Artifacts from Hyperledger Fabric Repsitories](#retrieve-artifacts-from-hyperledger-fabric-repsitories)
    - [Create Hyperledger Fabric Business Network](#create-hyperledger-fabric-business-network)
        - [Generate Peer and Orderer Certificates](#generate-peer-and-orderer-certificates)
        - [Create channel.tx and the Genesis Block Using the configtxgen Tool](#create-channeltx-and-the-genesis-block-using-the-configtxgen-tool)
            - [Creating/Modifying configtx.yaml](#creatingmodifying-configtxyaml)
            - [Executing the configtxgen Tool](#executing-the-configtxgen-tool)
    - [Start the Hyperledger Fabric blockchain network](#start-the-hyperledger-fabric-blockchain-network)
        - [Modifying the docker-compose yaml Files](#modifying-the-docker-compose-yaml-files)
        - [Start the docker Containers](#start-the-docker-containers)
        - [The channel](#the-channel)
            - [Create the channel](#create-the-channel)
            - [Join channel](#join-channel)
            - [Update anchor peers](#update-anchor-peers)
        - [Install chaincode](#install-chaincode)
        - [Instantiate chaincode](#instantiate-chaincode)
        - [Execute tutorial scenario](#execute-tutorial-scenario)
            - [Query for initial state of the ledger](#query-for-initial-state-of-the-ledger)
            - [Invoke chaincode](#invoke-chaincode)
            - [Query for the new values](#query-for-the-new-values)
    - [Summary](#summary)
    - [What is Next?](#what-is-next)
    - [References?](#references)

## Recommended Reading
Before you start this tutorial, you may want to get familar with the basic concepts of Hyperledger Fabric. Official Hyperledger Fabric documentation provides comprehensive source of information related to Hyperledger Fabric configuration, modes of operation and prerequisites. We recommend to read the following articles and use them as the reference when going through this tutorial.

* Hyperledger Fabric Glossary - http://hyperledger-fabric.readthedocs.io/en/latest/glossary.html
* Hyperledger Fabric Model - http://hyperledger-fabric.readthedocs.io/en/latest/fabric_model.html
* Hyperledger Fabric Prerequisities - http://hyperledger-fabric.readthedocs.io/en/latest/prereqs.html
* Hyperledger Fabric Samples - https://github.com/hyperledger/fabric-samples
* Building Your First Network - http://hyperledger-fabric.readthedocs.io/en/latest/build_network.html

## Setup Your Environment
### Utility Packages
### Docker
Docker is a tool for deploying, executing, and managing containers. Hyperledger Fabric is by default packaged as a set of Docker images and it is ready to be run as Docker container.

To install the Docker, we can go to [Docker website](https://docs.docker.com/install/linux/docker-ce/ubuntu/):

**SETUP THE REPOSITORY**
```sh
# 1. Update the apt package index:
sudo apt-get update

# 2. Install packages to allow apt to use repository over HTTPS:
sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    software-properties-common

# 3. Add Docker's official GPG key:
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -

sudo apt-key fingerprint 0EBFCD88

# 4. Setup the stable repository.
sudo add-apt-repository \
   "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   $(lsb_release -cs) \
   stable"
```

**INSTALL THE DOCKER CE**
```sh
# 1. Update the apt package index
sudo apt-get update

# 2. Install the latest version of Docker CE
sudo apt-get install docker-ce

```

### Docker Compose

Docker Compose is a tool for defining and running multi-container Docker applications. This is the case of Hyperledger Fabric default setup.

Docker Compose is typically installed as a part of your Docker installation. If not, it is necessary to install it separately. Run ```docker-compose --version``` command to find out if Docker Compose is present on your system.

To install Docker Compose on your Ubuntu 16.04 LTS system, please follow the instructions describe below or [follow the instruction how to install the docker compose in docker website](https://docs.docker.com/compose/install/#install-compose):

```sh
sudo curl -L https://github.com/docker/compose/releases/download/1.21.2/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose

sudo chmod +x /usr/local/bin/docker-compose

# Check the Docker Compose version
docker-compose --version
```
### Go language

In this tutorial, we use the Go language as the basis of chaincode in Hyperledger Fabric. For Hyperledger Fabric, the Go language version is 1.7 or higher.

To install the Go language in the system, please follow the below instructions:

```sh
# Downloading the golang file
wget https://dl.google.com/go/go1.9.3.linux-amd64.tar.gz

# Extract it in home directory
tar -xvf go1.9.3.linux-amd64.tar.gz
```
Create a gopath directory in the **HOME directory**.
``` sh
mkdir $HOME/gopath
```

Then we need to set the **Environment Variables** for our Golang in ~/.bashrc file such ```GOPATH```, ```GOROOT```, or ```GOBIN```.

```sh
export GOPATH=$HOME/gopath

export GOROOT=$HOME/go

export GOBIN=$HOME/go/bin

export PATH=$PATH:/$GOROOT/bin

```

Then run the command ```source ~/.bashrc``` to build the environment variables in the **.bashrc** file

## Retrieve Artifacts from Hyperledger Fabric Repsitories

To download and install Hyperledger Fabric binaries specific to your platform. This include downloading of ```cryptogen```, ```configtxgen```, ```configtxlator```, ```fabric-ca-client```, ```get-docker-images.sh```, ```orderer``` and ```peer``` tools and placing them into ```bin``` directory in the directory of your choice. In addition, the script will download Hyperlerdger Docker images into your local Docker registry.

Execute the following command to download Hyperledger Fabric binaries and Docker images:

```
curl -sSL http://bit.ly/2ysbOFE | bash -s 1.2.0
```

<img src="assets\.1. Hyperledger Fabric v1.2 - Create a Development Business Network on Ubuntu 16.04 LTS_images\a9ea9f1b.png" />

Here is the list images:
<img src="assets\.1. Hyperledger Fabric v1.2 - Create a Development Business Network on Ubuntu 16.04 LTS_images\6e8f6007.png" />

Then we can see the binary files and shell script file in the bin ```~/bin``` directory

<img src="assets\.1. Hyperledger Fabric v1.2 - Create a Development Business Network on Ubuntu 16.04 LTS_images\9085f8b4.png" />

For your convenience, you can add this directory with Hyperledger Fabric binaries to your **PATH** environment variables. You can modify the **export PATH** line in your ~/.bashrc


<img src="assets\.1. Hyperledger Fabric v1.2 - Create a Development Business Network on Ubuntu 16.04 LTS_images\5a852d84.png" /> 

And then run the command ```source ~/.bashrc``` to rebuild the export **PATH** environment variables.

## Create Hyperledger Fabric Business Network

This tutorial describes creating a business network and deploying chaincode using the Hyperledger Fabric v1.2.0 code base (found here: https://github.com/hyperledger/fabric.git). This tutorial exploits the Hyperledger Fabric v1.2.0 configuration toolset to create the business network consisting of the following items:
- Three orderer nodes (HRD Center Organization)
- OrdererType is Kafka (4 Kafka nodes and 3 zookeeper ensembles)
- Two peerOrganizations (Coocon and Webcash Company)
    - Coocon company has 2 peers
    - Webcash company has 2 peers
- Authentication Data Chaincode / Smart Contracts

At the end of this tutorial, you will have constructed a running instance of Hyperledger Fabric business network, as well as installed, instantiated, and executed chaincode.

For our tutorial we will make use of the Fabric deployment model based on Docker conatiners. Our network will run Docker containers running on our target Ubuntu 16.04 LTS (localhost).

### Generate Peer and Orderer Certificates
Nodes (such as peers and orderers) are permitted to access business networks using a membership service provider, which is typically in the form of a certificate authority. In this example, we use the development tool named ```cryptogen``` to generate the required certificates. We use a local MSP to store the certs, which are essentially a local directory structure, for each peer and orderer. In production environments, you can exploit the ```fabric ca``` toolset introducing full-featured certificate authorities to generate the certificates. 

```crytogen``` tool uses a ```yaml``` configuration file as its configuration - based on the content of this file, the required certificates are generated. We are going to create ```crypto-config.yaml``` file for our configuration. We are going to define two organizations of peers and three orderer organization.

Here is the listing of our ```crypto-config.yaml``` configuration file (for the purpose of simplicity, all comments are removed from this listing):
```yaml
OrdererOrgs:
  # ---------------------------------------------------------------------------
  # Orderer === KSHRD CENTER
  # ---------------------------------------------------------------------------
  - Name: Orderer
    Domain: kshrd.com.kh
    Specs:
      - Hostname: orderer1
      - Hostname: orderer2
      - Hostname: orderer3
PeerOrgs:
  # ---------------------------------------------------------------------------
  # Coocon Organization
  # ---------------------------------------------------------------------------
  - Name: Coocon
    Domain: coocon.kshrd.com.kh
    Template:
      Count: 2
    Users:
      Count: 1

  # ---------------------------------------------------------------------------
  # Webcash Organization
  # ---------------------------------------------------------------------------
  - Name: Webcash
    Domain: webcash.kshrd.com.kh
    Template:
      Count: 2
    Users:
      Count: 1

```

To generate certificates, run the following command:

```sh
cryptogen generate --config=./crypto-config.yaml
```

After running of crytogen tool you should see the following output in console:

<img src="assets\.1. Hyperledger Fabric v1.2 - Create a Development Business Network on Ubuntu 16.04 LTS_images\06cc800d.png" />

In addition, the new crypto-config directory has been created and contains various certificates and keys for orderers and peers.

First, let's check content under ```orderOrganizations```:
<img src="assets\.1. Hyperledger Fabric v1.2 - Create a Development Business Network on Ubuntu 16.04 LTS_images\416c7011.png" />

Second, let's check content under ```peerOrganizations```:

<img src="assets\.1. Hyperledger Fabric v1.2 - Create a Development Business Network on Ubuntu 16.04 LTS_images\ec72ba94.png" />

<img src="assets\.1. Hyperledger Fabric v1.2 - Create a Development Business Network on Ubuntu 16.04 LTS_images\c41f3926.png" />

### Create channel.tx and the Genesis Block Using the configtxgen Tool
#### Creating/Modifying configtx.yaml
#### Executing the configtxgen Tool
## Start the Hyperledger Fabric blockchain network
### Modifying the docker-compose yaml Files
### Start the docker Containers
### The channel
#### Create the channel
#### Join channel
#### Update anchor peers
### Install chaincode
### Instantiate chaincode
### Execute tutorial scenario
#### Query for initial state of the ledger
#### Invoke chaincode
#### Query for the new values
## Summary
At this point, our network is fully operational and this concludes our tutorial.

Here is a summary of the tasks that we completed:
- We installed all dependencies required to run Hyperledger Fabric v1.2. on Ubuntu 16.04 LTS.
- We retreived Hyperledger Fabric v1.2 artificats and binaries.
- We used the ```cryptogen``` tool to generate certificates and keys for the local MSP.
- We used the ```configtxgen``` tool to create our channel transaction and genesis block.
- We configured the ```docker-compose.yaml``` files to describe our networks and peers.
- We used the CLI container to perform the following tasks:
    - Create the channel
    - Deploy chaincode
    - Install chaincode
    - Invoke Chaincode
    - Query chaincode
## What is Next?
## References?